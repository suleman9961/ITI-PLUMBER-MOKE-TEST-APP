<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mock Test Ncn - AI Enhanced with Coins & Auth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #E0F2FE; /* Light blue background */
            padding-bottom: 80px; /* Footer padding */
            overflow-x: hidden;
        }
        .premium-tag { background-color: #FFA726; color: black; }
        .free-tag { background-color: #66BB6A; color: white; }
        .start-now-button-original-style { background-color: #EC4899; }
        .plumber-tag { background-color: #FFCA28; color: #374151; }
        .card-icon-placeholder { width: 50px; height: 50px; background-color: #E5E7EB; border-radius: 0.375rem; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; color: #6B7280; flex-shrink: 0; }
        .practice-button { background-color: #3B82F6; }
        .social-icon { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 0.5rem; }
        .sidebar { transition: transform 0.3s ease-in-out; transform: translateX(-100%); }
        .sidebar.open { transform: translateX(0); }
        .sidebar-overlay { transition: opacity 0.3s ease-in-out; }
        .auth-modal, .quiz-modal, .content-modal-container, .confirmation-modal, .top-scorer-modal { background-color: rgba(0, 0, 0, 0.75); transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; }
        .auth-modal-content, .quiz-modal-content, .content-modal-content, .confirmation-modal-content, .top-scorer-modal-content { max-height: 90vh; transition: transform 0.3s ease-out, opacity 0.3s ease-out; transform: translateY(-20px) scale(0.95); opacity: 0; }
        .auth-modal.active .auth-modal-content,
        .quiz-modal.active .quiz-modal-content,
        .content-modal-container.active .content-modal-content,
        .confirmation-modal.active .confirmation-modal-content,
        .top-scorer-modal.active .top-scorer-modal-content { transform: translateY(0) scale(1); opacity: 1; }
        .quiz-option { transition: background-color 0.2s ease, border-color 0.2s ease; }
        .quiz-option:hover { background-color: #d1e5fb; border-color: #3B82F6; }
        .quiz-option.selected { background-color: #3B82F6; color: white; border-color: #2563EB; }
        .quiz-option.correct { background-color: #10B981; color: white; border-color: #059669; }
        .quiz-option.incorrect { background-color: #EF4444; color: white; border-color: #DC2626; }
        .quiz-option.disabled { opacity: 0.5; pointer-events: none; }
        .lifeline-btn.disabled { opacity: 0.4; cursor: not-allowed; background-color: #9CA3AF !important; }
        .timer-bar { height: 8px; background-color: #3B82F6; transition: width 1s linear; width: 100%; }
        .audience-poll-bar { background-color: #3B82F6; transition: width 0.5s ease-out; }
        .coin-icon { width: 20px; height: 20px; margin-left: 5px; vertical-align: middle; }
        .sub-card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem; /* gap-3 */
            margin-top: 0.75rem; /* mt-3 */
        }
        .sub-card {
            padding: 0.75rem; /* p-3 */
            border-radius: 0.375rem; /* rounded-md */
            text-align: left;
            transition: background-color 0.2s ease;
            cursor: pointer;
        }
        .premium-sub-card {
            background-color: #4A5568; /* bg-slate-700 */
            color: white;
        }
        .premium-sub-card:hover {
            background-color: #2D3748; /* bg-slate-800 or darker */
        }
        .premium-sub-card.disabled {
            background-color: #718096; /* Lighter slate for disabled */
            color: #A0AEC0;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .free-sub-card {
            background-color: #EBF8FF; /* bg-blue-50 */
            color: #2B6CB0; /* text-blue-700 */
            border: 1px solid #BEE3F8; /* border-blue-200 */
        }
        .free-sub-card:hover {
            background-color: #C3DAFE; /* bg-blue-200 */
        }
        .tab-button.active {
            border-bottom-color: #3B82F6; /* blue-600 */
            color: #3B82F6; /* blue-600 */
            font-weight: 600;
        }
        .error-message {
            color: #EF4444; /* text-red-500 */
            font-size: 0.875rem; /* text-sm */
            margin-top: 0.25rem; /* mt-1 */
        }
    </style>
</head>
<body>

    <div id="sidebar" class="sidebar fixed top-0 left-0 h-full w-64 sm:w-72 bg-slate-800 text-white z-[60] shadow-lg p-0 flex flex-col">
        <div class="bg-blue-600 p-4 flex items-center space-x-3">
            <img src="https://placehold.co/40x40/FFFFFF/3B82F6?text=Logo" alt="Logo" class="w-10 h-10 rounded-md bg-white p-1">
            <div>
                <h2 class="text-lg font-semibold">Mock Test</h2>
                <p class="text-sm text-blue-200">NcvtOnline</p>
            </div>
        </div>
        <nav class="flex-grow pt-4 space-y-1 overflow-y-auto">
            <a href="#" id="sidebarProfileLink" class="flex items-center px-4 py-3 text-sm text-slate-200 hover:bg-slate-700 rounded-md mx-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                </svg> Profile
            </a>
            <a href="#" id="sidebarTopScorerLink" class="flex items-center px-4 py-3 text-sm text-slate-200 hover:bg-slate-700 rounded-md mx-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                </svg> Top Scorer
            </a>
             <a href="#" class="flex items-center px-4 py-3 text-sm text-slate-200 hover:bg-slate-700 rounded-md mx-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
                </svg> Statistics
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-sm text-slate-200 hover:bg-slate-700 rounded-md mx-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0" />
                </svg> Notification
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-sm text-slate-200 hover:bg-slate-700 rounded-md mx-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.5 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z" />
                </svg> Favorite Question
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-sm text-slate-200 hover:bg-slate-700 rounded-md mx-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z" />
                </svg> Invite friends
            </a>
            <a href="#" class="flex items-center px-4 py-3 text-sm text-slate-200 hover:bg-slate-700 rounded-md mx-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12" />
                </svg> Instruction
            </a>
             <a href="#" id="sidebarLogoutLink" class="flex items-center px-4 py-3 text-sm text-slate-200 hover:bg-slate-700 rounded-md mx-2 mt-auto mb-2 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-3">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0h3m0 0-3-3m3 3-3 3" />
                </svg> Logout
            </a>
        </nav>
    </div>
    <div id="sidebarOverlay" class="sidebar-overlay fixed inset-0 bg-black bg-opacity-50 z-50 hidden"></div>

    <header class="bg-blue-600 text-white p-4 shadow-md sticky top-0 z-40">
        <div class="container mx-auto flex items-center justify-between">
            <button id="hamburgerButton" aria-label="Open menu" class="p-1 -ml-1">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                </svg>
            </button>
            <h1 class="text-xl font-semibold">Mock Test Ncn</h1>
            <div class="flex items-center space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
                </svg>
                <button id="headerUserIcon" aria-label="User profile or Login/Signup" class="focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <div class="container mx-auto p-4">
        <section class="bg-blue-500 text-white p-4 rounded-lg shadow-lg mt-1">
            <div class="flex items-center mb-2">
                <img id="userAvatarMain" src="https://placehold.co/60x60/FFFFFF/3B82F6?text=User" alt="User Avatar" class="w-12 h-12 rounded-full border-2 border-white mr-3">
                <div>
                    <h2 id="userNameMain" class="text-lg font-semibold">
                        Guest User
                    </h2>
                    <span id="userCoinsDisplay" class="ml-0 text-yellow-300 font-bold">
                        (<span id="coinCount">0</span> 🪙)
                    </span>
                    <div class="flex space-x-4 text-sm mt-1">
                        <span>ID: <span id="userIdDisplay" class="font-normal">N/A</span></span>
                    </div>
                </div>
            </div>
            <div class="mt-2 text-center">
                <span class="plumber-tag inline-block px-3 py-1 text-sm font-semibold rounded-md shadow">Plumber</span>
            </div>
        </section>

        <section class="bg-white p-5 rounded-lg shadow-lg mt-5">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-bold text-blue-700">Ncvt Online Learning</h2>
                <div class="flex space-x-2">
                    <button class="p-2 bg-gray-200 rounded-md hover:bg-gray-300">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-gray-600">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                        </svg>
                    </button>
                    <button class="p-2 bg-green-100 rounded-md hover:bg-green-200">
                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-green-600">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                        </svg>
                    </button>
                </div>
            </div>
            <button id="triggerQuizButton" class="start-now-button-original-style w-full text-white font-semibold py-3 px-4 rounded-lg mt-4 flex items-center justify-center text-lg hover:bg-pink-600 transition duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" />
                </svg>
                Start Now (Quiz)
            </button>
        </section>

        <section class="mt-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold text-gray-800">All Mock Test For Your Trade</h3>
                <a href="#" class="text-blue-600 font-medium hover:underline text-sm">View All</a>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                <div id="freeTestCardPlumberEnglish" class="bg-white rounded-xl shadow-lg p-4 relative border-t-4 border-blue-500">
                    <span class="free-tag absolute top-3 right-3 px-2 py-1 text-xs font-semibold rounded">Free</span>
                    <div class="flex items-start space-x-3">
                        <div class="card-icon-placeholder">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 text-blue-500">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6-2.292m0 0V21M12 6.042A8.967 8.967 0 0 1 18 3.75m0 14.25V6.042" />
                            </svg>
                        </div>
                        <div>
                            <h4 class="text-md font-bold text-gray-800">ITI Mock Test</h4>
                            <p class="text-sm text-gray-600 font-medium">Plumber All Subject</p>
                            <p class="text-xs text-gray-500">( English )</p>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <p class="text-sm font-semibold text-blue-700 mb-2">Plumber - English Sections</p>
                        <div id="freePlumberEnglishSubCardsContainer" class="sub-card-grid">
                            <button class="sub-card free-sub-card" data-subtest="basic_concepts_en">
                                <h5 class="font-semibold">Basic Concepts</h5>
                                <p class="text-xs">Learn fundamentals</p>
                            </button>
                            <button class="sub-card free-sub-card" data-subtest="safety_symbols_en">
                                <h5 class="font-semibold">Safety Symbols</h5>
                                <p class="text-xs">Understand signs</p>
                            </button>
                            <button class="sub-card free-sub-card" data-subtest="measurement_tools_en">
                                <h5 class="font-semibold">Measurement Tools</h5>
                                <p class="text-xs">Tool details</p>
                            </button>
                            <button class="sub-card free-sub-card" data-subtest="practice_drills_en">
                                <h5 class="font-semibold">Practice Drills</h5>
                                <p class="text-xs">Quick exercises</p>
                            </button>
                        </div>
                    </div>
                </div>

                <div id="premiumTestCardPlumberHindi" class="bg-slate-800 text-white rounded-xl shadow-lg p-4 relative border-t-4 border-yellow-400">
                     <span class="premium-tag absolute top-3 right-3 px-2 py-1 text-xs font-semibold rounded">Premium</span>
                     <div class="flex items-start space-x-3">
                        <div class="card-icon-placeholder bg-slate-700">
                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 text-yellow-400">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                            </svg>
                        </div>
                        <div>
                            <h4 class="text-md font-bold text-white">ITI Mock Test (Premium Section)</h4>
                            <p class="text-sm text-slate-300 font-medium">प्लम्बर सभी विषय</p>
                            <p class="text-xs text-slate-400">( English | हिंदी )</p>
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-slate-700">
                        <div id="premiumPlumberHindiStatus" class="mb-2 text-sm text-yellow-200">
                            Loading status...
                        </div>
                        <button id="unlockPremiumPlumberHindiButton" data-testid="premium_plumber_hindi" data-cost="500" class="mb-3 w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-3 rounded-lg text-sm transition opacity-50 cursor-not-allowed" disabled>
                            Check Status
                        </button>
                        <div id="premiumPlumberHindiSubCardsContainer" class="sub-card-grid hidden">
                            <button class="sub-card premium-sub-card disabled" data-subtest="handwritten_notes_hi">
                                <h5 class="font-semibold">हस्तलिखित नोट्स</h5>
                                <p class="text-xs text-slate-400">विस्तृत नोट्स पढ़ें</p>
                            </button>
                            <button class="sub-card premium-sub-card disabled" data-subtest="theory_hi">
                                <h5 class="font-semibold">थ्योरी</h5>
                                <p class="text-xs text-slate-400">अवधारणाएं समझें</p>
                            </button>
                            <button class="sub-card premium-sub-card disabled" data-subtest="mock_test_hi">
                                <h5 class="font-semibold">मॉक टेस्ट</h5>
                                <p class="text-xs text-slate-400">परीक्षा का अभ्यास करें</p>
                            </button>
                            <button class="sub-card premium-sub-card disabled" data-subtest="test_preparation_hi">
                                <h5 class="font-semibold">टेस्ट तैयारी</h5>
                                <p class="text-xs text-slate-400">रणनीतियाँ और सुझाव</p>
                            </button>
                            <button class="sub-card premium-sub-card disabled" data-subtest="file_making_hi">
                                <h5 class="font-semibold">फाइल मेकिंग</h5>
                                <p class="text-xs text-slate-400">प्रैक्टिकल कार्य</p>
                            </button>
                            <button class="sub-card premium-sub-card disabled" data-subtest="tools_detail_hi">
                                <h5 class="font-semibold">उपकरण विवरण</h5>
                                <p class="text-xs text-slate-400">उपकरणों की जानकारी</p>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-4 relative border-t-4 border-blue-500 sm:col-span-2 md:col-span-1">
                     <div class="flex items-start space-x-3">
                        <div class="card-icon-placeholder">
                             <img src="https://placehold.co/50x50/E5E7EB/3B82F6?text=Theory" alt="Theory Icon" class="w-full h-full object-cover rounded-md">
                        </div>
                        <div>
                            <h4 class="text-md font-bold text-gray-800">Plumber Theory</h4>
                            <p class="text-sm text-gray-600 font-medium">प्लम्बर थ्योरी | Plu...</p>
                        </div>
                    </div>
                     <div class="mt-3 pt-3 border-t border-gray-200">
                        <p class="text-sm font-semibold text-blue-700">Detailed Study Material</p>
                        <p class="text-xs text-gray-500 mt-1">Covers all essential concepts</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="bg-white p-5 rounded-lg shadow-lg mt-6">
            <div class="flex items-center mb-3">
                <div class="card-icon-placeholder bg-orange-100 mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-orange-500">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                </div>
                <h3 class="text-md font-semibold text-gray-800">All Questions Practice</h3>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <button class="practice-button text-white font-semibold py-3 px-2 rounded-lg flex items-center justify-center text-sm hover:bg-blue-700 transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-1">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" />
                    </svg>
                    CBT Exam Test
                </button>
                <button class="practice-button text-white font-semibold py-3 px-2 rounded-lg flex items-center justify-center text-sm hover:bg-blue-700 transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-1">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" />
                    </svg>
                    Daily Test
                </button>
            </div>
        </section>

        <section class="bg-white p-5 rounded-lg shadow-lg mt-6">
            <div class="flex items-center mb-3">
                <div class="card-icon-placeholder bg-indigo-100 mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-indigo-500">
                         <path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 0 0-.491 6.347A48.627 48.627 0 0 1 12 20.904a48.627 48.627 0 0 1 8.232-4.41 60.46 60.46 0 0 0-.491-6.347m-15.482 0a50.57 50.57 0 0 0-2.658-.813A59.906 59.906 0 0 1 12 3.493a59.902 59.902 0 0 1 10.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.697 50.697 0 0 1 12 13.489a50.702 50.702 0 0 1 7.74-3.342M6.75 15a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm0 0v-3.675A55.378 55.378 0 0 1 12 8.443m-7.007 11.55A5.981 5.981 0 0 0 6.75 15.75v-1.5" />
                    </svg>
                </div>
                <h3 class="text-md font-semibold text-gray-800">CBT Exam Contest</h3>
            </div>
            <button class="w-full practice-button text-white font-semibold py-3 px-4 rounded-lg mt-2 flex items-center justify-center text-lg hover:bg-blue-700 transition duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" />
                </svg>
                Join Now
            </button>
             <div class="flex justify-end space-x-1 mt-2">
                <div class="w-8 h-8 bg-pink-500 rounded-full flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 0 1 1.037-.443 48.282 48.282 0 0 0 5.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z" />
                    </svg>
                </div>
                 <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a8.25 8.25 0 0 1-16.5 0v-8.25m16.5 0a3.75 3.75 0 0 0-7.5 0m7.5 0a3.75 3.75 0 0 1-7.5 0m7.5 0v3.75m-7.5-3.75V6a3.75 3.75 0 0 0-7.5 0v1.5m7.5 0v3.75m0-3.75a3.75 3.75 0 0 0-3.75-3.75V6a3.75 3.75 0 0 0-3.75 3.75v1.5m0 0V6a3.75 3.75 0 0 0-3.75-3.75v1.5A3.75 3.75 0 0 0 6 11.25m0 0v3.75m0-3.75a3.75 3.75 0 0 1 3.75-3.75v3.75A3.75 3.75 0 0 1 6 11.25m0 0H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125h2.25M17.625 11.25h2.25c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125h-2.25" />
                    </svg>
                </div>
                 <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="white" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                    </svg>
                </div>
            </div>
        </section>

        <section class="bg-white p-5 rounded-lg shadow-lg mt-6">
            <div class="flex items-center mb-3">
                <div class="card-icon-placeholder bg-teal-100 mr-3">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 text-teal-500">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-7.5h6m-6 3h6m-6-3h6M15 12h3.75M15 15h3.75M15 9h3.75M3 12h3.75M3 15h3.75M3 9h3.75" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 8.25h9m-9 3.75h9m-9 3.75h9M3.75 3.75h16.5v16.5H3.75V3.75Z" />
                    </svg>
                </div>
                <h3 class="text-md font-semibold text-gray-800">AI से सीखें (Learn with AI)</h3>
            </div>
            <button id="askQuestionBtn" class="w-full bg-sky-500 hover:bg-sky-600 text-white font-semibold py-3 px-4 rounded-lg mt-2 flex items-center justify-center text-lg transition duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
                </svg>
                नया सवाल पूछें (Ask New Question)
            </button>
            <div id="aiQuestionArea" class="mt-4 p-4 bg-gray-100 rounded-md min-h-[60px] text-gray-700" style="display: none;">
                <p id="aiQuestionText" class="font-medium text-sm sm:text-base"></p>
            </div>
            <button id="getExplanationBtn" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg mt-3 flex items-center justify-center text-lg transition duration-150" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 mr-2">
                     <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" />
                </svg>
                जवाब समझाएं (Explain Answer)
            </button>
            <div id="aiLoadingIndicator" class="mt-4 text-center text-gray-600" style="display: none;">
                <svg class="animate-spin h-5 w-5 mr-3 inline-block text-blue-500" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                AI सोच रहा है... (AI is thinking...)
            </div>
            <div id="aiExplanationArea" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md min-h-[80px] text-gray-800 text-sm sm:text-base" style="display: none;">
                <p id="aiExplanationText" class="whitespace-pre-wrap"></p>
            </div>
        </section>

        <section class="bg-blue-600 text-white p-4 rounded-lg shadow-lg mt-6 text-center">
            <h3 class="text-md font-semibold mb-3">Join Our Social Groups! To Connect US!</h3>
            <div class="flex justify-center space-x-3 sm:space-x-4">
                <a href="#" class="social-icon bg-red-600 hover:bg-red-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0C.488 3.411 0 5.295 0 10.001c0 4.705.488 6.589 4.385 6.816 3.6.245 11.626.246 15.23 0 3.897-.227 4.385-2.111 4.385-6.816-.001-4.706-.488-6.59-4.385-6.817zm-10.615 12.707V4.109l6.06 3.948-6.06 3.948z"/>
                    </svg>
                </a>
                <a href="#" class="social-icon bg-pink-500 hover:bg-pink-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.948-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.162 6.162 6.162 6.162-2.759 6.162-6.162-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4s1.791-4 4-4 4 1.79 4 4-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                    </svg>
                </a>
                <a href="#" class="social-icon bg-blue-400 hover:bg-blue-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M22.448 3.329a1.13 1.13 0 0 0-1.53-.61L1.674 9.616a1.128 1.128 0 0 0 .07 2.106l4.11 1.235 1.235 4.11a1.128 1.128 0 0 0 2.106.07l6.897-19.244a1.13 1.13 0 0 0-.61-1.53zm-5.076 5.076L9.861 15.916l-.882-2.938-2.938-.882 7.511-7.511z"/>
                    </svg>
                </a>
                <a href="#" class="social-icon bg-green-500 hover:bg-green-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448L.057 24zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.149-.172.198-.296.297-.495.099-.198.05-.372-.025-.521-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.47.074-.742.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/>
                    </svg>
                </a>
                <a href="#" class="social-icon bg-blue-700 hover:bg-blue-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/>
                    </svg>
                </a>
            </div>
        </section>
    </div>

    <footer class="fixed bottom-0 left-0 right-0 bg-white shadow-t-lg border-t border-gray-200 p-3 flex justify-around items-center z-40">
        <button class="flex flex-col items-center text-blue-600 hover:text-blue-800">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" />
            </svg>
            <span class="text-xs mt-1">Home</span>
        </button>
        <button class="flex flex-col items-center text-gray-500 hover:text-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6-2.292m0 0V21M12 6.042A8.967 8.967 0 0 1 18 3.75m0 14.25V6.042" />
            </svg>
            <span class="text-xs mt-1">Tests</span>
        </button>
        <button id="footerProfileButton" class="flex flex-col items-center text-gray-500 hover:text-blue-600">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>
            <span class="text-xs mt-1">Profile</span>
        </button>
    </footer>

    <div id="authModal" class="auth-modal fixed inset-0 z-[100] flex items-center justify-center p-4 hidden">
        <div class="auth-modal-content bg-slate-50 w-full max-w-md rounded-xl shadow-2xl p-6 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-blue-700">Profile / Authentication</h2>
                <button id="closeAuthModalButton" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div id="authStatus" class="mb-4 p-3 bg-blue-100 text-blue-700 rounded-md text-sm hidden"></div>

            <div class="mb-4 border-b border-gray-200">
                <nav class="flex space-x-4" aria-label="Tabs">
                    <button id="loginTabButton" class="tab-button py-3 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 text-sm font-medium active">
                        Login (लॉग इन करें)
                    </button>
                    <button id="signupTabButton" class="tab-button py-3 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 text-sm font-medium">
                        Signup (साइन अप करें)
                    </button>
                </nav>
            </div>

            <form id="loginForm" class="space-y-4">
                <div>
                    <label for="loginEmail" class="block text-sm font-medium text-gray-700">Email (ईमेल)</label>
                    <input type="email" id="loginEmail" name="loginEmail" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
                <div>
                    <label for="loginPassword" class="block text-sm font-medium text-gray-700">Password (पासवर्ड)</label>
                    <input type="password" id="loginPassword" name="loginPassword" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition">Login (लॉग इन करें)</button>
                <p id="loginError" class="error-message hidden"></p>
            </form>

            <form id="signupForm" class="space-y-4 hidden">
                <div>
                    <label for="signupName" class="block text-sm font-medium text-gray-700">Full Name (पूरा नाम)</label>
                    <input type="text" id="signupName" name="signupName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
                <div>
                    <label for="signupEmail" class="block text-sm font-medium text-gray-700">Email (ईमेल)</label>
                    <input type="email" id="signupEmail" name="signupEmail" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
                <div>
                    <label for="signupPassword" class="block text-sm font-medium text-gray-700">Password (पासवर्ड)</label>
                    <input type="password" id="signupPassword" name="signupPassword" required minlength="6" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
                <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition">Signup (साइन अप करें)</button>
                <p id="signupError" class="error-message hidden"></p>
            </form>
        </div>
    </div>

    <div id="topScorerModal" class="top-scorer-modal fixed inset-0 z-[95] flex items-center justify-center p-4 hidden">
        <div class="top-scorer-modal-content bg-slate-50 w-full max-w-lg rounded-xl shadow-2xl p-6 overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-blue-700">🏆 Top Scorers (शीर्ष स्कोरर) 🏆</h2>
                <button id="closeTopScorerModalButton" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="topScorerList" class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <span class="text-lg font-semibold text-yellow-500 mr-3">1.</span>
                        <img src="https://placehold.co/40x40/A7F3D0/10B981?text=R" alt="User R" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium text-gray-800">Rakesh Kumar</span>
                    </div>
                    <span class="font-semibold text-blue-600">15000 🪙</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <span class="text-lg font-semibold text-gray-400 mr-3">2.</span>
                        <img src="https://placehold.co/40x40/BAE6FD/0EA5E9?text=P" alt="User P" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium text-gray-800">Priya Sharma</span>
                    </div>
                    <span class="font-semibold text-blue-600">14500 🪙</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <span class="text-lg font-semibold text-orange-400 mr-3">3.</span>
                        <img src="https://placehold.co/40x40/FBCFE8/DB2777?text=A" alt="User A" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium text-gray-800">Amit Singh</span>
                    </div>
                    <span class="font-semibold text-blue-600">13800 🪙</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <span class="text-md font-medium text-gray-500 mr-3 ml-1">4.</span>
                        <img src="https://placehold.co/40x40/DDD6FE/7C3AED?text=S" alt="User S" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium text-gray-800">Sunita Devi</span>
                    </div>
                    <span class="font-semibold text-blue-600">12000 🪙</span>
                </div>
                 <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <span class="text-md font-medium text-gray-500 mr-3 ml-1">5.</span>
                        <img src="https://placehold.co/40x40/C4B5FD/6D28D9?text=V" alt="User V" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium text-gray-800">Vikram Rathore</span>
                    </div>
                    <span class="font-semibold text-blue-600">11500 🪙</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <span class="text-md font-medium text-gray-500 mr-3 ml-1">6.</span>
                        <img src="https://placehold.co/40x40/A5F3FC/0891B2?text=N" alt="User N" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium text-gray-800">Neha Gupta</span>
                    </div>
                    <span class="font-semibold text-blue-600">10900 🪙</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <span class="text-md font-medium text-gray-500 mr-3 ml-1">7.</span>
                        <img src="https://placehold.co/40x40/FDE68A/F59E0B?text=M" alt="User M" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium text-gray-800">Manoj Tiwari</span>
                    </div>
                    <span class="font-semibold text-blue-600">10200 🪙</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <span class="text-md font-medium text-gray-500 mr-3 ml-1">8.</span>
                        <img src="https://placehold.co/40x40/FECACA/DC2626?text=K" alt="User K" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium text-gray-800">Kavita Patel</span>
                    </div>
                    <span class="font-semibold text-blue-600">9800 🪙</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <span class="text-md font-medium text-gray-500 mr-3 ml-1">9.</span>
                        <img src="https://placehold.co/40x40/BBF7D0/16A34A?text=D" alt="User D" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium text-gray-800">Deepak Joshi</span>
                    </div>
                    <span class="font-semibold text-blue-600">9500 🪙</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex items-center">
                        <span class="text-md font-medium text-gray-500 mr-3 ml-1">10.</span>
                        <img src="https://placehold.co/40x40/BFDBFE/3B82F6?text=G" alt="User G" class="w-10 h-10 rounded-full mr-3">
                        <span class="font-medium text-gray-800">Geeta Kumari</span>
                    </div>
                    <span class="font-semibold text-blue-600">9200 🪙</span>
                </div>
            </div>
            <p class="mt-6 text-sm text-gray-600 text-center">Note: This is a sample leaderboard. (यह एक नमूना लीडरबोर्ड है।)</p>
        </div>
    </div>


    <div id="quizModal" class="quiz-modal fixed inset-0 z-[70] flex items-center justify-center p-4 hidden">
        <div class="quiz-modal-content bg-slate-50 w-full max-w-2xl rounded-xl shadow-2xl p-6 overflow-y-auto">
            <div id="quizSetupScreen">
                <h2 class="text-2xl font-bold text-center text-blue-700 mb-6">प्लंबिंग क्विज़ (Plumbing Quiz)</h2>
                <p class="text-center text-gray-700 mb-2">आप कितने प्रश्न हल करना चाहते हैं? (How many questions do you want to attempt?)</p>
                <div class="flex justify-center space-x-3 mb-6">
                    <button data-count="5" class="num-questions-btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition">5 प्रश्न</button>
                    <button data-count="10" class="num-questions-btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition">10 प्रश्न</button>
                    <button data-count="15" class="num-questions-btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition">15 प्रश्न</button>
                </div>
                 <p class="text-center text-xs text-gray-500 mb-4">प्रत्येक प्रश्न के लिए 1 मिनट का समय होगा। (You will have 1 minute for each question.)</p>
                <button id="startSelectedQuizButton" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition disabled:opacity-50" disabled>क्विज़ शुरू करें (Start Quiz)</button>
                <button id="closeQuizSetupButton" class="mt-3 w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg transition">बंद करें (Close)</button>
            </div>

            <div id="quizInterfaceScreen" class="hidden">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-xl font-bold text-blue-700">प्रश्न <span id="currentQuestionNumber"></span>/<span id="totalQuizQuestions"></span></h2>
                    <div class="text-lg font-semibold text-red-500">समय: <span id="quizTimer">01:00</span></div>
                </div>
                <div class="w-full bg-gray-300 rounded-full mb-4">
                    <div id="questionTimerBar" class="timer-bar rounded-full"></div>
                </div>

                <div id="questionImageContainer" class="mb-4 text-center hidden">
                    <img id="questionImage" src="" alt="प्रश्न सम्बंधित चित्र" class="max-w-full h-auto max-h-48 mx-auto rounded-lg shadow-md object-contain">
                </div>
                <p id="questionText" class="text-lg sm:text-xl font-semibold text-gray-800 mb-5 min-h-[60px]"></p>

                <div id="optionsContainer" class="space-y-3 mb-6">
                    </div>

                <div class="mb-6">
                    <h3 class="text-md font-semibold text-gray-700 mb-2 text-center">लाइफलाइन (Lifelines):</h3>
                    <div class="flex justify-center space-x-2 sm:space-x-4">
                        <button id="lifeline5050" class="lifeline-btn bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-3 sm:px-4 rounded-lg flex items-center text-sm transition">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-1 hidden sm:inline">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" />
                            </svg>
                            50/50
                        </button>
                        <button id="lifelineAudiencePoll" class="lifeline-btn bg-purple-500 hover:bg-purple-600 text-white font-semibold py-2 px-3 sm:px-4 rounded-lg flex items-center text-sm transition">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-1 hidden sm:inline">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                            </svg>
                            ऑडियंस पोल
                        </button>
                    </div>
                </div>
                <div id="audiencePollResults" class="hidden mt-4 space-y-2">
                    </div>

                <button id="nextQuestionButton" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-lg transition hidden">अगला प्रश्न (Next Question)</button>
                <button id="closeQuizInterfaceButton" class="mt-3 w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg transition">क्विज़ बंद करें (Close Quiz)</button>
            </div>

            <div id="quizResultsScreen" class="hidden text-center">
                <h2 class="text-3xl font-bold text-green-600 mb-4">क्विज़ समाप्त! (Quiz Finished!)</h2>
                <img src="https://placehold.co/100x100/E0F2FE/10B981?text=🏆" alt="Trophy" class="mx-auto mb-4 w-24 h-24">
                <p class="text-xl text-gray-800 mb-2">आपका स्कोर (Your Score): <span id="finalScore"></span></p>
                <p class="text-lg text-gray-700 mb-6">आपने <span id="coinsEarnedInQuiz">0</span> सिक्के कमाए! (You earned <span id="coinsEarnedInQuizDup">0</span> coins!)</p>
                <div class="space-y-3 sm:space-y-0 sm:flex sm:space-x-4 justify-center">
                    <button id="playAgainButton" class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-lg transition">फिर से खेलें (Play Again)</button>
                    <button id="closeQuizResultsButton" class="w-full sm:w-auto bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg text-lg transition">बंद करें (Close)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="confirmationModal" class="confirmation-modal fixed inset-0 z-[80] flex items-center justify-center p-4 hidden">
        <div class="confirmation-modal-content bg-white w-full max-w-md rounded-xl shadow-2xl p-6">
            <h2 id="confirmationTitle" class="text-xl font-bold text-gray-800 mb-4">Confirm Purchase</h2>
            <p id="confirmationMessage" class="text-gray-700 mb-6">Are you sure you want to spend 500 coins to unlock this test for 1 month?</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelUnlockButton" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-lg transition">Cancel</button>
                <button id="confirmUnlockButton" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition">Confirm & Unlock</button>
            </div>
        </div>
    </div>

    <div id="contentModal" class="content-modal-container fixed inset-0 z-[90] flex items-center justify-center p-4 hidden">
        <div class="content-modal-content bg-white w-full max-w-lg rounded-xl shadow-2xl p-6 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h2 id="contentModalTitle" class="text-xl font-bold text-blue-700">Content Title</h2>
                <button id="closeContentModalButton" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="contentModalImageContainer" class="mb-4 text-center hidden">
                <img id="contentModalImage" src="" alt="Content Image" class="max-w-full h-auto max-h-48 mx-auto rounded-lg shadow-md object-contain">
            </div>
            <div id="contentModalBody" class="text-gray-700 space-y-4 text-sm sm:text-base">
                </div>
        </div>
    </div>


    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            setDoc, 
            updateDoc, 
            Timestamp,
            increment,
            onSnapshot,
            setLogLevel
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Firebase Configuration and Initialization ---
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "YOUR_API_KEY", authDomain: "YOUR_AUTH_DOMAIN", projectId: "YOUR_PROJECT_ID" }; // Fallback for local
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        const fbApp = initializeApp(firebaseConfig);
        const auth = getAuth(fbApp);
        const db = getFirestore(fbApp);
        setLogLevel('debug'); 

        let currentUserId = null;
        let currentUserData = { displayName: "Guest User", coins: 0, premiumAccess: {} };
        let unsubscribeUserData = null; 

        // DOM Elements for User Profile
        const userNameMainEl = document.getElementById('userNameMain');
        const userAvatarMainEl = document.getElementById('userAvatarMain'); // Placeholder for future avatar use
        const userIdDisplayEl = document.getElementById('userIdDisplay');
        const coinCountEl = document.getElementById('coinCount');
        
        // DOM Elements for Auth Modal
        const authModal = document.getElementById('authModal');
        const closeAuthModalButton = document.getElementById('closeAuthModalButton');
        const loginTabButton = document.getElementById('loginTabButton');
        const signupTabButton = document.getElementById('signupTabButton');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const loginErrorEl = document.getElementById('loginError');
        const signupErrorEl = document.getElementById('signupError');
        const authStatusEl = document.getElementById('authStatus');
        const sidebarProfileLink = document.getElementById('sidebarProfileLink');
        const headerUserIcon = document.getElementById('headerUserIcon');
        const footerProfileButton = document.getElementById('footerProfileButton');
        const sidebarLogoutLink = document.getElementById('sidebarLogoutLink');

        // DOM Elements for Top Scorer Modal
        const topScorerModal = document.getElementById('topScorerModal');
        const sidebarTopScorerLink = document.getElementById('sidebarTopScorerLink');
        const closeTopScorerModalButton = document.getElementById('closeTopScorerModalButton');


        // --- Authentication State Change Handler ---
        onAuthStateChanged(auth, async (user) => {
            if (user) { // User is signed in (either anonymously or with email/pass)
                console.log("User is signed in:", user.uid, "Anonymous:", user.isAnonymous);
                currentUserId = user.uid;
                
                if (unsubscribeUserData) unsubscribeUserData(); // Unsubscribe from previous listener
                listenToUserData(currentUserId); // Listen to data for the current user

                // If user just signed up/logged in (not anonymous), ensure their profile is set
                if (!user.isAnonymous && !currentUserData.profileInitialized) {
                     // Profile might be initialized by listenToUserData or needs an explicit call if new
                    await initializeUserData(currentUserId, user.displayName || "User", user.email);
                }
                updateUIAfterAuthChange(user);

            } else { // User is signed out
                console.log("User is signed out.");
                currentUserId = null;
                currentUserData = { displayName: "Guest User", coins: 0, premiumAccess: {} }; 
                if (unsubscribeUserData) unsubscribeUserData(); 
                updateUIAfterAuthChange(null);
                // Attempt to sign in anonymously if no user is present
                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                        console.log("Signed in with custom token after logout.");
                    } else {
                        await signInAnonymously(auth);
                        console.log("Signed in anonymously after logout.");
                    }
                } catch (error) {
                    console.error("Error during anonymous sign-in after logout:", error);
                }
            }
        });

        function updateUIAfterAuthChange(user) {
            if (user) {
                userNameMainEl.textContent = currentUserData.displayName || (user.isAnonymous ? "Guest User" : user.email);
                // userAvatarMainEl.src = currentUserData.photoURL || `https://placehold.co/60x60/FFFFFF/3B82F6?text=${(currentUserData.displayName || 'U')[0].toUpperCase()}`;
                userIdDisplayEl.textContent = user.uid.substring(0, 8) + "...";
                coinCountEl.textContent = currentUserData.coins !== undefined ? currentUserData.coins : 0;
                sidebarLogoutLink.classList.remove('hidden');
                authStatusEl.textContent = `Logged in as: ${user.email || 'Anonymous Guest'}`;
                authStatusEl.classList.remove('hidden');
                loginForm.classList.add('hidden'); // Hide forms if logged in
                signupForm.classList.add('hidden');
                loginTabButton.classList.add('hidden');
                signupTabButton.classList.add('hidden');

            } else { // Logged out state
                userNameMainEl.textContent = "Guest User";
                // userAvatarMainEl.src = "https://placehold.co/60x60/FFFFFF/3B82F6?text=U";
                userIdDisplayEl.textContent = "N/A";
                coinCountEl.textContent = 0;
                sidebarLogoutLink.classList.add('hidden');
                authStatusEl.classList.add('hidden');
                loginForm.classList.remove('hidden'); // Show forms if logged out
                signupForm.classList.add('hidden'); // Default to login tab
                loginTabButton.classList.remove('hidden');
                signupTabButton.classList.remove('hidden');
                loginTabButton.classList.add('active');
                signupTabButton.classList.remove('active');
            }
            updatePremiumTestUI(); // Also update premium test UI as it depends on user data
        }


        async function initializeUserData(userId, displayName, email) {
            if (!userId) return;
            const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile`);
            try {
                const docSnap = await getDoc(userDocRef);
                if (!docSnap.exists()) {
                    const initialData = {
                        displayName: displayName || "User " + userId.substring(0, 6),
                        email: email || null,
                        coins: 0, 
                        premiumAccess: {},
                        createdAt: Timestamp.now(),
                        profileInitialized: true 
                    };
                    await setDoc(userDocRef, initialData);
                    console.log("New user profile created in Firestore:", initialData);
                    currentUserData = initialData; // Update local cache immediately
                } else {
                    // If doc exists, ensure displayName is updated if provided (e.g., after signup)
                    const existingData = docSnap.data();
                    currentUserData = existingData; // Load existing data
                    if (displayName && existingData.displayName !== displayName) {
                        await updateDoc(userDocRef, { displayName: displayName });
                        currentUserData.displayName = displayName;
                         console.log("User display name updated in Firestore.");
                    }
                    if (!existingData.profileInitialized) { // Mark as initialized if it wasn't
                        await updateDoc(userDocRef, { profileInitialized: true });
                        currentUserData.profileInitialized = true;
                    }
                }
            } catch (error) {
                console.error("Error initializing/updating user data:", error);
            }
        }
        
        function listenToUserData(userId) {
            if (!userId) return;
            const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile`);
            unsubscribeUserData = onSnapshot(userDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    currentUserData = docSnap.data();
                    console.log("User data updated via onSnapshot:", currentUserData);
                    // Update UI elements that depend on currentUserData
                    userNameMainEl.textContent = currentUserData.displayName || (auth.currentUser?.isAnonymous ? "Guest User" : auth.currentUser?.email);
                    // userAvatarMainEl.src = currentUserData.photoURL || `https://placehold.co/60x60/FFFFFF/3B82F6?text=${(currentUserData.displayName || 'U')[0].toUpperCase()}`;
                    coinCountEl.textContent = currentUserData.coins !== undefined ? currentUserData.coins : 0;
                    updatePremiumTestUI(); 
                } else {
                    console.log("User document does not exist in snapshot listener for ID:", userId, ". Attempting to re-initialize if user is not anonymous.");
                    // Only re-initialize if it's a non-anonymous user, as anonymous profiles are created on demand
                    if (auth.currentUser && !auth.currentUser.isAnonymous) {
                         initializeUserData(userId, auth.currentUser.displayName, auth.currentUser.email);
                    } else if (!auth.currentUser) { // If user somehow got deleted but is logged out
                        currentUserData = { displayName: "Guest User", coins: 0, premiumAccess: {} };
                        updateUIAfterAuthChange(null);
                    }
                }
            }, (error) => {
                console.error("Error listening to user data:", error);
            });
        }

        // --- Auth Modal Logic ---
        function openAuthModal() {
            authModal.classList.remove('hidden');
            authModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            // Reset forms and errors
            loginForm.reset();
            signupForm.reset();
            loginErrorEl.classList.add('hidden');
            signupErrorEl.classList.add('hidden');
            
            // Update status and form visibility based on current auth state
            if (auth.currentUser && !auth.currentUser.isAnonymous) {
                authStatusEl.textContent = `You are currently logged in as: ${auth.currentUser.email}. You can logout from the sidebar.`;
                authStatusEl.classList.remove('hidden');
                loginForm.classList.add('hidden');
                signupForm.classList.add('hidden');
                loginTabButton.classList.add('hidden');
                signupTabButton.classList.add('hidden');
            } else {
                authStatusEl.classList.add('hidden');
                loginForm.classList.remove('hidden'); // Default to login
                signupForm.classList.add('hidden');
                loginTabButton.classList.remove('hidden');
                signupTabButton.classList.remove('hidden');
                loginTabButton.classList.add('active');
                signupTabButton.classList.remove('active');
            }
        }
        sidebarProfileLink.addEventListener('click', (e) => { e.preventDefault(); openAuthModal(); });
        headerUserIcon.addEventListener('click', openAuthModal);
        footerProfileButton.addEventListener('click', openAuthModal);
        closeAuthModalButton.addEventListener('click', () => {
            authModal.classList.add('hidden');
            authModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        });

        loginTabButton.addEventListener('click', () => {
            loginTabButton.classList.add('active');
            signupTabButton.classList.remove('active');
            loginForm.classList.remove('hidden');
            signupForm.classList.add('hidden');
            loginErrorEl.classList.add('hidden');
            signupErrorEl.classList.add('hidden');
        });
        signupTabButton.addEventListener('click', () => {
            signupTabButton.classList.add('active');
            loginTabButton.classList.remove('active');
            signupForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
            loginErrorEl.classList.add('hidden');
            signupErrorEl.classList.add('hidden');
        });

        // --- Signup Handler ---
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = signupForm.signupName.value.trim();
            const email = signupForm.signupEmail.value.trim();
            const password = signupForm.signupPassword.value;
            signupErrorEl.classList.add('hidden');

            if (!name) {
                signupErrorEl.textContent = "Name is required.";
                signupErrorEl.classList.remove('hidden');
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                // Update Firebase Auth profile (optional, but good practice)
                await updateProfile(user, { displayName: name });
                // Initialize/Update user data in Firestore
                await initializeUserData(user.uid, name, user.email); 
                
                console.log("Signup successful:", user);
                authModal.classList.add('hidden'); // Close modal on success
                authModal.classList.remove('active');
                document.body.style.overflow = 'auto';
                // onAuthStateChanged will handle UI updates
            } catch (error) {
                console.error("Signup error:", error);
                signupErrorEl.textContent = error.message;
                signupErrorEl.classList.remove('hidden');
            }
        });

        // --- Login Handler ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = loginForm.loginEmail.value.trim();
            const password = loginForm.loginPassword.value;
            loginErrorEl.classList.add('hidden');
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                console.log("Login successful:", userCredential.user);
                authModal.classList.add('hidden'); // Close modal on success
                authModal.classList.remove('active');
                document.body.style.overflow = 'auto';
                 // onAuthStateChanged will handle UI updates and data fetching
            } catch (error) {
                console.error("Login error:", error);
                loginErrorEl.textContent = error.message;
                loginErrorEl.classList.remove('hidden');
            }
        });
        
        // --- Logout Handler ---
        sidebarLogoutLink.addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                await signOut(auth);
                console.log("User signed out successfully.");
                // onAuthStateChanged will handle UI updates and anonymous sign-in
                // Close sidebar if open
                if (sidebar.classList.contains('open')) {
                    toggleSidebar();
                }
            } catch (error) {
                console.error("Logout error:", error);
            }
        });

        // --- Top Scorer Modal Logic ---
        sidebarTopScorerLink.addEventListener('click', (e) => {
            e.preventDefault();
            topScorerModal.classList.remove('hidden');
            topScorerModal.classList.add('active');
            document.body.style.overflow = 'hidden';
            // In a real app, you would fetch and render dynamic data here.
            // For now, it uses the static HTML list.
        });
        closeTopScorerModalButton.addEventListener('click', () => {
            topScorerModal.classList.add('hidden');
            topScorerModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        });


        // --- Premium Test Logic (mostly unchanged, relies on currentUserData from onSnapshot) ---
        const premiumTestButton = document.getElementById('unlockPremiumPlumberHindiButton');
        const premiumTestStatusEl = document.getElementById('premiumPlumberHindiStatus');
        const premiumPlumberHindiSubCardsContainer = document.getElementById('premiumPlumberHindiSubCardsContainer');
        const PREMIUM_TEST_ID = "premium_plumber_hindi"; 
        const PREMIUM_TEST_COST = 500;

        function updatePremiumTestUI() {
            if (!currentUserData) { 
                premiumTestStatusEl.textContent = "Loading user data...";
                premiumTestButton.disabled = true;
                premiumTestButton.classList.add('opacity-50', 'cursor-not-allowed');
                premiumPlumberHindiSubCardsContainer.classList.add('hidden');
                premiumPlumberHindiSubCardsContainer.querySelectorAll('.premium-sub-card').forEach(card => card.classList.add('disabled'));
                return;
            }

            const testAccess = currentUserData.premiumAccess?.[PREMIUM_TEST_ID];
            const userCoins = currentUserData.coins !== undefined ? currentUserData.coins : 0;
            
            premiumPlumberHindiSubCardsContainer.classList.add('hidden'); 
            premiumPlumberHindiSubCardsContainer.querySelectorAll('.premium-sub-card').forEach(card => {
                card.classList.add('disabled');
                card.onclick = null;
            });

            if (testAccess && testAccess.expiresAt) {
                const expiryDate = testAccess.expiresAt.toDate();
                if (expiryDate > new Date()) {
                    premiumTestStatusEl.textContent = `Unlocked! Expires on: ${expiryDate.toLocaleDateString()}`;
                    premiumTestButton.textContent = "View Content (खुला हुआ)";
                    premiumTestButton.classList.remove('bg-green-600', 'hover:bg-green-700', 'opacity-50', 'cursor-not-allowed');
                    premiumTestButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    premiumTestButton.disabled = true; 
                    
                    premiumPlumberHindiSubCardsContainer.classList.remove('hidden');
                    premiumPlumberHindiSubCardsContainer.querySelectorAll('.premium-sub-card').forEach(card => {
                        card.classList.remove('disabled');
                        card.onclick = () => {
                            // Find the content for this premium sub-test and display it
                            // This part needs specific content data similar to freeContentData
                            const subtestKey = card.dataset.subtest;
                            console.log(`Accessing premium sub-test: ${subtestKey}`);
                            // Example: openContentModalForPremium(subtestKey);
                            openContentModalGeneric(subtestKey, true);
                        }
                    });
                    return; 
                } else {
                     premiumTestStatusEl.textContent = `Premium access expired.`; 
                }
            } else {
                 premiumTestStatusEl.textContent = `Cost: ${PREMIUM_TEST_COST} coins. You have ${userCoins}.`;
            }
            
            premiumTestButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            premiumTestButton.classList.add('bg-green-600', 'hover:bg-green-700');
            
            if (auth.currentUser && !auth.currentUser.isAnonymous) { // Only allow unlock for logged-in (non-anonymous) users
                if (userCoins >= PREMIUM_TEST_COST) {
                    premiumTestButton.textContent = `Unlock Section for ${PREMIUM_TEST_COST} 🪙`;
                    premiumTestButton.disabled = false;
                    premiumTestButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    premiumTestButton.onclick = () => handleUnlockPremiumTest(PREMIUM_TEST_ID, PREMIUM_TEST_COST);
                } else {
                    premiumTestButton.textContent = `Need ${PREMIUM_TEST_COST - userCoins} more 🪙`;
                    premiumTestButton.disabled = true;
                    premiumTestButton.classList.add('opacity-50', 'cursor-not-allowed');
                    premiumTestButton.onclick = null;
                }
            } else { // Anonymous or logged-out users cannot unlock
                premiumTestButton.textContent = `Login to Unlock (कीमत: ${PREMIUM_TEST_COST} 🪙)`;
                premiumTestButton.disabled = true;
                premiumTestButton.classList.add('opacity-50', 'cursor-not-allowed');
                premiumTestButton.onclick = openAuthModal; // Prompt to login
            }
        }

        async function handleUnlockPremiumTest(testId, cost) {
            if (!currentUserId || (auth.currentUser && auth.currentUser.isAnonymous)) {
                premiumTestStatusEl.textContent = "Please login to unlock premium content.";
                openAuthModal();
                return;
            }
            if (!currentUserData || (currentUserData.coins !== undefined ? currentUserData.coins : 0) < cost) {
                premiumTestStatusEl.textContent = "Not enough coins or user data error.";
                return;
            }
            
            const confirmationModal = document.getElementById('confirmationModal');
            const confirmationTitle = document.getElementById('confirmationTitle');
            const confirmationMessage = document.getElementById('confirmationMessage');
            const confirmUnlockButton = document.getElementById('confirmUnlockButton');
            const cancelUnlockButton = document.getElementById('cancelUnlockButton');

            confirmationTitle.textContent = `Unlock "प्लम्बर सभी विषय" Section?`;
            confirmationMessage.textContent = `Are you sure you want to spend ${cost} coins to unlock this section for 1 month?`;
            
            confirmationModal.classList.remove('hidden');
            confirmationModal.classList.add('active');

            confirmUnlockButton.onclick = async () => {
                confirmationModal.classList.add('hidden');
                confirmationModal.classList.remove('active');

                const userDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/profile`);
                const now = Timestamp.now();
                const expiryDate = new Date(now.toDate());
                expiryDate.setMonth(expiryDate.getMonth() + 1);
                const expiryTimestamp = Timestamp.fromDate(expiryDate);

                const currentPremiumAccess = currentUserData.premiumAccess || {};
                const newPremiumAccess = {
                    ...currentPremiumAccess,
                    [testId]: {
                        unlockedAt: now,
                        expiresAt: expiryTimestamp
                    }
                };
                try {
                    await updateDoc(userDocRef, {
                        coins: increment(-cost), 
                        premiumAccess: newPremiumAccess
                    });
                    console.log(`Section ${testId} unlocked. Coins deducted. Firestore update sent.`);
                } catch (error) {
                    console.error("Error unlocking premium section:", error);
                    premiumTestStatusEl.textContent = "Error during unlock. Please try again.";
                }
            };
            cancelUnlockButton.onclick = () => {
                confirmationModal.classList.add('hidden');
                confirmationModal.classList.remove('active');
            };
        }
        async function updateUserCoins(userId, amount) {
            if (!userId) {
                console.error("Cannot update coins: No userId provided.");
                return;
            }
            if (amount === 0) {
                 console.log("No coins to update (amount is 0).");
                 return;
            }
            const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile`);
            console.log(`Attempting to update coins for user ${userId} by ${amount}. Current local coins before Firestore call: ${currentUserData?.coins}`);
            try {
                await updateDoc(userDocRef, {
                    coins: increment(amount) 
                });
                console.log(`SUCCESS: Coins update request sent to Firestore for user ${userId} by ${amount}. Waiting for onSnapshot to reflect the change in UI.`);
            } catch (error) {
                console.error(`ERROR updating coins in Firestore for user ${userId}:`, error);
            }
        }


        // --- Sidebar Functionality ---
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const hamburgerButton = document.getElementById('hamburgerButton');
        function toggleSidebar() {
            sidebar.classList.toggle('open');
            sidebarOverlay.classList.toggle('hidden');
            document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : 'auto';
        }
        hamburgerButton.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);

        // --- AI Q&A Functionality (unchanged) ---
        const askQuestionBtn = document.getElementById('askQuestionBtn');
        const aiQuestionArea = document.getElementById('aiQuestionArea');
        const aiQuestionTextEl = document.getElementById('aiQuestionText');
        const getExplanationBtn = document.getElementById('getExplanationBtn');
        const aiExplanationArea = document.getElementById('aiExplanationArea');
        const aiExplanationTextEl = document.getElementById('aiExplanationText');
        const aiLoadingIndicator = document.getElementById('aiLoadingIndicator');
        let currentAiGeneralQuestion = "";
        const sampleGeneralQuestions = [
            "प्लंबिंग में इस्तेमाल होने वाले सामान्य प्रकार के रिंच कौन से हैं? (What are the common types of wrenches used in plumbing?)",
            "पी-ट्रैप का उद्देश्य क्या है? (What is the purpose of a P-trap?)",
            "भारत की राजधानी क्या है? (What is the capital of India?)",
        ];
        askQuestionBtn.addEventListener('click', () => {
            aiExplanationArea.style.display = 'none';
            aiExplanationTextEl.textContent = '';
            getExplanationBtn.style.display = 'flex';
            const randomIndex = Math.floor(Math.random() * sampleGeneralQuestions.length);
            currentAiGeneralQuestion = sampleGeneralQuestions[randomIndex];
            aiQuestionTextEl.textContent = currentAiGeneralQuestion;
            aiQuestionArea.style.display = 'block';
        });
        getExplanationBtn.addEventListener('click', async () => {
            if (!currentAiGeneralQuestion) return;
            aiLoadingIndicator.style.display = 'block';
            aiExplanationArea.style.display = 'none';
            aiExplanationTextEl.textContent = '';
            getExplanationBtn.disabled = true;
            const prompt = `कृपया इस प्रश्न का उत्तर सरल और स्पष्ट भाषा में समझाएं: "${currentAiGeneralQuestion}". सुनिश्चित करें कि जवाब हिंदी में हो।`;
            try {
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`API Error: ${response.status} ${response.statusText}`);
                const result = await response.json();
                if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    aiExplanationTextEl.textContent = result.candidates[0].content.parts[0].text;
                } else {
                    aiExplanationTextEl.textContent = "माफ़ कीजिए, AI अभी जवाब नहीं दे पा रहा है।";
                }
            } catch (error) {
                console.error('Error fetching explanation:', error);
                aiExplanationTextEl.textContent = `जवाब प्राप्त करने में एक त्रुटि हुई।`;
            } finally {
                aiExplanationArea.style.display = 'block';
                aiLoadingIndicator.style.display = 'none';
                getExplanationBtn.disabled = false;
            }
        });

        // --- MCQ Quiz Functionality ---
        const triggerQuizButton = document.getElementById('triggerQuizButton');
        const quizModal = document.getElementById('quizModal');
        const quizSetupScreen = document.getElementById('quizSetupScreen');
        const quizInterfaceScreen = document.getElementById('quizInterfaceScreen');
        const quizResultsScreen = document.getElementById('quizResultsScreen');
        const numQuestionsButtons = document.querySelectorAll('.num-questions-btn');
        const startSelectedQuizButton = document.getElementById('startSelectedQuizButton');
        const closeQuizSetupButton = document.getElementById('closeQuizSetupButton');
        const currentQuestionNumberEl = document.getElementById('currentQuestionNumber');
        const totalQuizQuestionsEl = document.getElementById('totalQuizQuestions');
        const quizTimerEl = document.getElementById('quizTimer');
        const questionTimerBar = document.getElementById('questionTimerBar');
        const questionImageContainer = document.getElementById('questionImageContainer');
        const questionImageEl = document.getElementById('questionImage');
        const questionTextQuizEl = document.getElementById('questionText'); 
        const optionsContainer = document.getElementById('optionsContainer');
        const lifeline5050Button = document.getElementById('lifeline5050');
        const lifelineAudiencePollButton = document.getElementById('lifelineAudiencePoll');
        const audiencePollResultsEl = document.getElementById('audiencePollResults');
        const nextQuestionButton = document.getElementById('nextQuestionButton');
        const closeQuizInterfaceButton = document.getElementById('closeQuizInterfaceButton');
        const finalScoreEl = document.getElementById('finalScore');
        const playAgainButton = document.getElementById('playAgainButton');
        const closeQuizResultsButton = document.getElementById('closeQuizResultsButton');
        const coinsEarnedInQuizEl = document.getElementById('coinsEarnedInQuiz');
        const coinsEarnedInQuizDupEl = document.getElementById('coinsEarnedInQuizDup');

        let allPlumbingQuestions = [
            { id: 1, text: "चित्र में दिखाए गए उपकरण का नाम क्या है? (What is the name of the tool shown in the picture?)", image: "https://placehold.co/300x200/E0F2FE/3B82F6?text=Pipe+Wrench", options: [{ text: "पाइप रिंच (Pipe Wrench)", correct: true },{ text: "समायोज्य रिंच (Adjustable Wrench)", correct: false },{ text: "सॉकेट रिंच (Socket Wrench)", correct: false },{ text: "टॉर्क रिंच (Torque Wrench)", correct: false }]},
            { id: 2, text: "पानी के रिसाव को रोकने के लिए पाइप थ्रेड्स पर आमतौर पर किस सामग्री का उपयोग किया जाता है? (Which material is commonly used on pipe threads to prevent water leaks?)", image: null, options: [{ text: "टेफ्लॉन टेप (Teflon Tape)", correct: true },{ text: "डक्ट टेप (Duct Tape)", correct: false },{ text: "रबर सीमेंट (Rubber Cement)", correct: false },{ text: "सिलिकॉन सीलेंट (Silicone Sealant)", correct: false }]},
            { id: 3, text: "पी-ट्रैप का मुख्य कार्य क्या है? (What is the main function of a P-trap?)", image: "https://placehold.co/300x200/E0F2FE/3B82F6?text=P-Trap+Diagram", options: [{ text: "पानी के प्रवाह को बढ़ाना (Increase water flow)", correct: false },{ text: "गटर गैसों को घर में प्रवेश करने से रोकना (Prevent sewer gases from entering the house)", correct: true },{ text: "पानी के दबाव को नियंत्रित करना (Regulate water pressure)", correct: false },{ text: "पाइप को साफ रखना (Keep pipes clean)", correct: false }]},
            { id: 4, text: "इनमें से कौन सा एक प्रकार का प्लंबिंग वाल्व नहीं है? (Which of these is NOT a type of plumbing valve?)", image: null, options: [{ text: "गेट वाल्व (Gate Valve)", correct: false },{ text: "बॉल वाल्व (Ball Valve)", correct: false },{ text: "बटरफ्लाई वाल्व (Butterfly Valve)", correct: false },{ text: "पिस्टन वाल्व (Piston Valve)", correct: true }]}, 
            { id: 5, text: "शौचालय फ्लश सिस्टम में साइफन प्रभाव का क्या महत्व है? (What is the significance of the siphon effect in a toilet flush system?)", image: null, options: [{ text: "यह टैंक को तेजी से भरता है (It fills the tank quickly)", correct: false },{ text: "यह कटोरे से अपशिष्ट को प्रभावी ढंग से निकालता है (It effectively removes waste from the bowl)", correct: true },{ text: "यह पानी बचाता है (It conserves water)", correct: false },{ text: "यह शोर को कम करता है (It reduces noise)", correct: false }]},
            { id: 6, text: "चित्र में किस प्रकार की पाइप फिटिंग दिखाई गई है? (What type of pipe fitting is shown in the picture?)", image: "https://placehold.co/300x200/E0F2FE/3B82F6?text=Elbow+Fitting", options: [{ text: "टी (Tee)", correct: false },{ text: "एल्बो (Elbow)", correct: true },{ text: "कपलिंग (Coupling)", correct: false },{ text: "यूनियन (Union)", correct: false }]},
            { id: 7, text: "वॉटर हीटर में एनोड रॉड का उद्देश्य क्या है? (What is the purpose of an anode rod in a water heater?)", image: null, options: [{ text: "पानी को तेजी से गर्म करना (To heat water faster)", correct: false },{ text: "टैंक को जंग लगने से बचाना (To protect the tank from corrosion)", correct: true },{ text: "पानी के दबाव को बढ़ाना (To increase water pressure)", correct: false },{ text: "पानी को फिल्टर करना (To filter water)", correct: false }]},
            { id: 8, text: "तांबे के पाइप को जोड़ने के लिए आमतौर पर किस प्रक्रिया का उपयोग किया जाता है? (Which process is commonly used for joining copper pipes?)", image: null, options: [{ text: "वेल्डिंग (Welding)", correct: false },{ text: "सोल्डरिंग (Soldering)", correct: true },{ text: "थ्रेडिंग (Threading)", correct: false },{ text: "क्लैंपिंग (Clamping)", correct: false }]},
            { id: 9, text: "एक 'चेक वाल्व' का उद्देश्य क्या है? (What is the purpose of a 'check valve'?)", image: "https://placehold.co/300x200/E0F2FE/3B82F6?text=Check+Valve", options: [{ text: "पानी के प्रवाह को रोकना (To stop water flow)", correct: false },{ text: "पानी के दबाव को कम करना (To reduce water pressure)", correct: false },{ text: "बैकफ्लो को रोकना (To prevent backflow)", correct: true },{ text: "पानी के तापमान को नियंत्रित करना (To control water temperature)", correct: false }]},
            { id: 10, text: "डीपीडब्ल्यूसी पाइप का क्या अर्थ है? (What does DWV pipe stand for?)", image: null, options: [{ text: "ड्रिंक वॉटर वैक्यूम (Drink Water Vacuum)", correct: false },{ text: "ड्रेन वेस्ट वेंट (Drain Waste Vent)", correct: true },{ text: "ड्यूअल वॉटर वेंट (Dual Water Vent)", correct: false },{ text: "डीप वॉटर वैल्व (Deep Water Valve)", correct: false }]},
            { id: 11, text: "चित्र में दिखाए गए उपकरण का उपयोग किस लिए किया जाता है? (What is the tool shown in the picture used for?)", image: "https://placehold.co/300x200/E0F2FE/3B82F6?text=Plunger", options: [{ text: "पाइप काटने के लिए (For cutting pipes)", correct: false },{ text: "नालियों को खोलने के लिए (For unclogging drains)", correct: true },{ text: "पाइप को कसने के लिए (For tightening pipes)", correct: false },{ text: "रिसाव का पता लगाने के लिए (For detecting leaks)", correct: false }]},
            { id: 12, text: "प्लंबिंग में 'वाटर हैमर' क्या है? (What is 'water hammer' in plumbing?)", image: null, options: [{ text: "एक प्रकार का पाइप (A type of pipe)", correct: false },{ text: "एक उपकरण (A tool)", correct: false },{ text: "पाइप में अचानक दबाव परिवर्तन से होने वाला शोर (Noise caused by sudden pressure change in pipes)", correct: true },{ text: "पानी का रिसाव (A water leak)", correct: false }]},
            { id: 13, text: "कौन सा पाइप सामग्री आमतौर पर गर्म पानी की लाइनों के लिए अनुशंसित नहीं है? (Which pipe material is generally NOT recommended for hot water lines?)", image: null, options: [{ text: "कॉपर (Copper)", correct: false },{ text: "सीपीवीसी (CPVC)", correct: false },{ text: "पीवीसी (PVC - Schedule 40/80 for cold water primarily)", correct: true },{ text: "पीईएक्स (PEX)", correct: false }]},
            { id: 14, text: "एक 'यूनियन' फिटिंग का उपयोग किस लिए किया जाता है? (What is a 'union' fitting used for?)", image: "https://placehold.co/300x200/E0F2FE/3B82F6?text=Union+Fitting", options: [{ text: "पाइप की दिशा बदलने के लिए (To change pipe direction)", correct: false },{ text: "दो पाइपों को स्थायी रूप से जोड़ने के लिए (To permanently join two pipes)", correct: false },{ text: "पाइप को आसानी से अलग करने की अनुमति देने के लिए (To allow easy disassembly of pipes)", correct: true },{ text: "पाइप के आकार को कम करने के लिए (To reduce pipe size)", correct: false }]},
            { id: 15, text: "सुरक्षा के लिए, गैस लाइनों पर काम करने से पहले पहला कदम क्या होना चाहिए? (For safety, what should be the first step before working on gas lines?)", image: null, options: [{ text: "खिड़कियां खोलें (Open windows)", correct: false },{ text: "मुख्य गैस आपूर्ति बंद करें (Shut off the main gas supply)", correct: true },{ text: "उपकरण इकट्ठा करें (Gather tools)", correct: false },{ text: "सुरक्षा चश्मा पहनें (Wear safety goggles)", correct: false }]}
        ];


        let currentQuizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let coinsThisQuiz = 0; 
        let timeLeft = 60; 
        let timerInterval;
        let selectedNumOfQuestions = 0;
        let lifelines = { fiftyFiftyUsed: false, audiencePollUsed: false };

        triggerQuizButton.addEventListener('click', () => {
            if (!auth.currentUser || auth.currentUser.isAnonymous) {
                openAuthModal(); // Prompt login if anonymous or not logged in
                // Optionally, display a message like "Please login to take the quiz."
                const tempMsg = document.createElement('p');
                tempMsg.textContent = "Please login to start the quiz. (क्विज़ शुरू करने के लिए कृपया लॉग इन करें।)";
                tempMsg.classList.add('text-red-500', 'text-center', 'my-2', 'text-sm');
                triggerQuizButton.parentNode.insertBefore(tempMsg, triggerQuizButton.nextSibling);
                setTimeout(() => tempMsg.remove(), 3000);
                return;
            }
            quizModal.classList.remove('hidden');
            quizModal.classList.add('active');
            showQuizScreen('setup');
            document.body.style.overflow = 'hidden';
        });

        function closeQuizModal() {
            quizModal.classList.add('hidden');
            quizModal.classList.remove('active');
            document.body.style.overflow = 'auto';
            if (timerInterval) clearInterval(timerInterval);
        }

        closeQuizSetupButton.addEventListener('click', closeQuizModal);
        closeQuizInterfaceButton.addEventListener('click', closeQuizModal);
        closeQuizResultsButton.addEventListener('click', closeQuizModal);

        numQuestionsButtons.forEach(button => {
            button.addEventListener('click', () => {
                numQuestionsButtons.forEach(btn => btn.classList.replace('bg-green-500', 'bg-blue-500')); 
                button.classList.replace('bg-blue-500', 'bg-green-500'); 
                selectedNumOfQuestions = parseInt(button.dataset.count);
                startSelectedQuizButton.disabled = false;
            });
        });

        startSelectedQuizButton.addEventListener('click', () => {
            if (selectedNumOfQuestions > 0 && selectedNumOfQuestions <= allPlumbingQuestions.length) {
                initializeQuiz();
                showQuizScreen('interface');
            } else if (selectedNumOfQuestions > allPlumbingQuestions.length) {
                alert(`Sorry, only ${allPlumbingQuestions.length} questions are available. Please select a smaller number.`);
            }
        });
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function initializeQuiz() {
            shuffleArray(allPlumbingQuestions); 
            currentQuizQuestions = allPlumbingQuestions.slice(0, selectedNumOfQuestions); 
            currentQuestionIndex = 0;
            score = 0;
            coinsThisQuiz = 0; 
            lifelines.fiftyFiftyUsed = false;
            lifelines.audiencePollUsed = false;
            updateLifelineButtons();
            loadQuestion();
        }

        function showQuizScreen(screenName) {
            quizSetupScreen.classList.add('hidden');
            quizInterfaceScreen.classList.add('hidden');
            quizResultsScreen.classList.add('hidden');

            if (screenName === 'setup') {
                quizSetupScreen.classList.remove('hidden');
                numQuestionsButtons.forEach(btn => btn.classList.replace('bg-green-500', 'bg-blue-500'));
                startSelectedQuizButton.disabled = true;
                selectedNumOfQuestions = 0;
            } else if (screenName === 'interface') {
                quizInterfaceScreen.classList.remove('hidden');
            } else if (screenName === 'results') {
                quizResultsScreen.classList.remove('hidden');
                finalScoreEl.textContent = `${score} / ${currentQuizQuestions.length}`;
                coinsEarnedInQuizEl.textContent = coinsThisQuiz;
                coinsEarnedInQuizDupEl.textContent = coinsThisQuiz;
                if (coinsThisQuiz > 0 && currentUserId && auth.currentUser && !auth.currentUser.isAnonymous) {
                    console.log(`Quiz ended. Earned ${coinsThisQuiz} coins. User ID: ${currentUserId}. Calling updateUserCoins.`);
                    updateUserCoins(currentUserId, coinsThisQuiz); 
                } else {
                    console.log(`Quiz ended. No coins to add or user is anonymous/not logged in. Coins earned: ${coinsThisQuiz}, UserID: ${currentUserId}`);
                }
            }
        }

        function loadQuestion() {
            if (currentQuestionIndex >= currentQuizQuestions.length) {
                showQuizScreen('results');
                return;
            }
            const question = currentQuizQuestions[currentQuestionIndex];
            currentQuestionNumberEl.textContent = currentQuestionIndex + 1;
            totalQuizQuestionsEl.textContent = currentQuizQuestions.length;
            questionTextQuizEl.textContent = question.text; 
            if (question.image) {
                questionImageEl.src = question.image;
                questionImageContainer.classList.remove('hidden');
            } else {
                questionImageContainer.classList.add('hidden');
            }
            optionsContainer.innerHTML = '';
            let shuffledOptions = [...question.options];
            shuffleArray(shuffledOptions);

            shuffledOptions.forEach((option) => {
                const button = document.createElement('button');
                button.classList.add('quiz-option', 'w-full', 'text-left', 'p-3', 'sm:p-4', 'border-2', 'border-gray-300', 'rounded-lg', 'hover:border-blue-500', 'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-400', 'transition', 'duration-150', 'text-sm', 'sm:text-base');
                button.textContent = option.text;
                button.dataset.correct = option.correct; 
                button.addEventListener('click', () => handleAnswer(option.correct, button, shuffledOptions));
                optionsContainer.appendChild(button);
            });
            audiencePollResultsEl.classList.add('hidden');
            audiencePollResultsEl.innerHTML = '';
            nextQuestionButton.classList.add('hidden');
            resetTimer();
            startTimer();
        }

        function handleAnswer(isCorrect, selectedButton, allDisplayedOptions) {
            clearInterval(timerInterval);
            
            allDisplayedOptions.forEach(opt => {
                const btn = Array.from(optionsContainer.children).find(b => b.textContent === opt.text);
                if (btn) {
                    btn.disabled = true;
                    btn.classList.add('disabled');
                    if (opt.correct) { 
                        btn.classList.add('correct');
                    }
                }
            });

            if (isCorrect) {
                score++;
                coinsThisQuiz++; 
                selectedButton.classList.remove('incorrect'); 
                selectedButton.classList.add('correct');
            } else {
                selectedButton.classList.add('incorrect');
            }
            nextQuestionButton.classList.remove('hidden');
        }
        
        nextQuestionButton.addEventListener('click', () => {
            currentQuestionIndex++;
            loadQuestion();
        });

        function startTimer() {
            timeLeft = 60; 
            quizTimerEl.textContent = `01:00`;
            questionTimerBar.style.width = '100%';
            questionTimerBar.style.backgroundColor = '#3B82F6'; 
            timerInterval = setInterval(() => {
                timeLeft--;
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                quizTimerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                questionTimerBar.style.width = `${(timeLeft / 60) * 100}%`;

                if (timeLeft < 10) questionTimerBar.style.backgroundColor = '#EF4444'; 
                else if (timeLeft < 20) questionTimerBar.style.backgroundColor = '#F59E0B'; 
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    Array.from(optionsContainer.children).forEach(btn => {
                        btn.disabled = true;
                        btn.classList.add('disabled');
                        const originalOption = currentQuizQuestions[currentQuestionIndex].options.find(o => o.text === btn.textContent);
                        if (originalOption && originalOption.correct) {
                            btn.classList.add('correct');
                        }
                    });
                    quizTimerEl.textContent = "00:00";
                    nextQuestionButton.classList.remove('hidden');
                }
            }, 1000);
        }
        
        function resetTimer() { clearInterval(timerInterval); }

        lifeline5050Button.addEventListener('click', () => {
            if (lifelines.fiftyFiftyUsed) return;
            const question = currentQuizQuestions[currentQuestionIndex];
            let incorrectOptionElements = [];
            Array.from(optionsContainer.children).forEach(btn => {
                if (btn.dataset.correct === "false" && !btn.classList.contains('disabled')) {
                    incorrectOptionElements.push(btn);
                }
            });

            shuffleArray(incorrectOptionElements);
            
            for (let i = 0; i < 2 && i < incorrectOptionElements.length; i++) {
                incorrectOptionElements[i].classList.add('disabled', 'opacity-50', 'pointer-events-none');
                incorrectOptionElements[i].style.visibility = 'hidden';
            }
            
            lifelines.fiftyFiftyUsed = true;
            updateLifelineButtons();
        });

        lifelineAudiencePollButton.addEventListener('click', () => {
            if (lifelines.audiencePollUsed) return;
            const question = currentQuizQuestions[currentQuestionIndex];
            audiencePollResultsEl.innerHTML = '';
            audiencePollResultsEl.classList.remove('hidden');
            let totalVotes = 0;

            const displayedOptions = Array.from(optionsContainer.children).filter(btn => !btn.style.visibility || btn.style.visibility !== 'hidden');

            const pollData = displayedOptions.map(btn => {
                const isCorrect = btn.dataset.correct === "true";
                let votes = isCorrect ? Math.floor(Math.random() * 40) + 50 : Math.floor(Math.random() * 30) + 5; 
                totalVotes += votes;
                return { text: btn.textContent, votes: votes };
            });

            if (totalVotes === 0 && pollData.length > 0) {
                pollData.forEach(item => item.votes = 100 / pollData.length); 
                totalVotes = 100;
            }


            pollData.forEach(item => {
                const percentage = totalVotes > 0 ? Math.round((item.votes / totalVotes) * 100) : 0;
                const pollBarContainer = document.createElement('div');
                pollBarContainer.classList.add('flex', 'items-center', 'space-x-2', 'text-sm');
                const optionText = document.createElement('div');
                optionText.classList.add('w-1/3', 'truncate', 'text-gray-700');
                optionText.textContent = item.text;
                const barOuter = document.createElement('div');
                barOuter.classList.add('w-2/3', 'bg-gray-200', 'rounded-full', 'h-5');
                const barInner = document.createElement('div');
                barInner.classList.add('audience-poll-bar', 'h-5', 'rounded-full', 'flex', 'items-center', 'justify-end', 'pr-2', 'text-xs', 'text-white', 'font-medium');
                barInner.style.width = `${percentage}%`;
                barInner.textContent = `${percentage}%`;
                barOuter.appendChild(barInner);
                pollBarContainer.appendChild(optionText);
                pollBarContainer.appendChild(barOuter);
                audiencePollResultsEl.appendChild(pollBarContainer);
            });
            lifelines.audiencePollUsed = true;
            updateLifelineButtons();
        });
        
        function updateLifelineButtons() {
            lifeline5050Button.classList.toggle('disabled', lifelines.fiftyFiftyUsed);
            lifelineAudiencePollButton.classList.toggle('disabled', lifelines.audiencePollUsed);
        }

        playAgainButton.addEventListener('click', () => { showQuizScreen('setup'); });

        // --- Content Modal Logic (Free & Premium) ---
        const contentModal = document.getElementById('contentModal');
        const contentModalTitle = document.getElementById('contentModalTitle');
        const contentModalImageContainer = document.getElementById('contentModalImageContainer');
        const contentModalImage = document.getElementById('contentModalImage');
        const contentModalBody = document.getElementById('contentModalBody');
        const closeContentModalButton = document.getElementById('closeContentModalButton');

        const freeContentData = {
            'basic_concepts_en': {
                title: "Basic Plumbing Concepts (मूल अवधारणाएँ)",
                image: "https://placehold.co/300x150/E0F2FE/3B82F6?text=Simple+Water+System+Diagram",
                body: `<div class="p-3 bg-blue-50 rounded-lg shadow"><h4 class="font-semibold text-blue-800 mb-1">Q1: What is the primary purpose of a plumbing system in a building?</h4><p class="italic text-blue-600 mb-1">(किसी भवन में प्लंबिंग सिस्टम का प्राथमिक उद्देश्य क्या है?)</p><p class="text-sm">A1: To supply clean water for drinking, cooking, and cleaning, and to safely remove wastewater and sewage. (स्वच्छ पानी की आपूर्ति करना और अपशिष्ट जल को सुरक्षित रूप से निकालना।)</p></div> <div class="p-3 bg-blue-50 rounded-lg shadow"><h4 class="font-semibold text-blue-800 mb-1">Q2: Name two common materials used for water supply pipes.</h4><p class="italic text-blue-600 mb-1">(पानी आपूर्ति पाइप के लिए उपयोग की जाने वाली दो सामान्य सामग्रियों के नाम बताइए।)</p><p class="text-sm">A2: PVC (Polyvinyl Chloride) and Copper. Other materials include PEX (Cross-linked polyethylene) and Galvanized Iron (though less common now for supply). (पीवीसी (पॉलीविनाइल क्लोराइड) और तांबा। अन्य सामग्रियों में पीईएक्स और जीआई शामिल हैं।)</p></div>`
            },
            'safety_symbols_en': {
                title: "Safety Symbols in Plumbing (प्लंबिंग में सुरक्षा संकेत)",
                image: null, 
                body: `<div class="p-3 bg-yellow-50 rounded-lg shadow flex items-start space-x-3"><img src="https://placehold.co/60x60/FFFF00/000000?text=⚠️&fontsize=30" alt="Warning Sign" class="w-12 h-12 object-contain rounded flex-shrink-0"><div><h4 class="font-semibold text-yellow-800">Danger/Warning (खतरा/चेतावनी)</h4><p class="text-sm">Indicates potential hazards like sharp objects, heavy loads, or general unsafe conditions. Proceed with extreme caution and follow all safety protocols. (संभावित खतरों को इंगित करता है। सावधानी से आगे बढ़ें।)</p></div></div> <div class="p-3 bg-blue-50 rounded-lg shadow flex items-start space-x-3"><img src="https://placehold.co/60x60/ADD8E6/000000?text=🧤+🥽&fontsize=20" alt="PPE Sign" class="w-12 h-12 object-contain rounded flex-shrink-0"><div><h4 class="font-semibold text-blue-800">Wear PPE (पीपीई पहनें)</h4><p class="text-sm">Personal Protective Equipment (e.g., safety glasses, gloves, hard hats, steel-toed boots) must be worn in this area or for this task. (व्यक्तिगत सुरक्षा उपकरण (जैसे दस्ताने, चश्मे) पहने जाने चाहिए।)</p></div></div> <div class="p-3 bg-red-50 rounded-lg shadow flex items-start space-x-3"><img src="https://placehold.co/60x60/FFD700/000000?text=⚡&fontsize=30" alt="Electrical Hazard Sign" class="w-12 h-12 object-contain rounded flex-shrink-0"><div><h4 class="font-semibold text-red-800">Electrical Hazard (विद्युत खतरा)</h4><p class="text-sm">Risk of electric shock. Be extremely careful with electrical components, power tools near water, or damaged wiring. Ensure power is off before working. (बिजली के झटके का खतरा। विद्युत घटकों से बेहद सावधान रहें।)</p></div></div>`
            },
            'measurement_tools_en': {
                title: "Common Measurement Tools (सामान्य माप उपकरण)",
                image: null, 
                body: `<div class="p-3 bg-indigo-50 rounded-lg shadow"><div class="flex items-start space-x-3 mb-1"><img src="https://placehold.co/100x70/E0F2FE/3B82F6?text=Measuring+Tape+Icon" alt="Measuring Tape" class="w-20 h-auto object-contain rounded flex-shrink-0"><div><h4 class="font-semibold text-indigo-800">Measuring Tape (मापने का टेप)</h4><p class="text-sm">Used for linear measurements (length, width, height of pipes, spaces, etc.). Available in various lengths (e.g., 3m, 5m, 10m) with markings in cm/mm and inches. (रैखिक माप के लिए उपयोग किया जाता है।)</p></div></div></div> <div class="p-3 bg-indigo-50 rounded-lg shadow"><div class="flex items-start space-x-3 mb-1"><img src="https://placehold.co/100x70/E0F2FE/3B82F6?text=Spirit+Level+Icon" alt="Spirit Level" class="w-20 h-auto object-contain rounded flex-shrink-0"><div><h4 class="font-semibold text-indigo-800">Spirit Level (स्पिरिट लेवल)</h4><p class="text-sm">Used to check if a surface or pipe installation is perfectly horizontal (level) or vertical (plumb). Crucial for proper drainage and fitting. (क्षैतिज या ऊर्ध्वाधर स्तर की जांच के लिए।)</p></div></div></div> <div class="p-3 bg-indigo-50 rounded-lg shadow"><div class="flex items-start space-x-3 mb-1"><img src="https://placehold.co/100x70/E0F2FE/3B82F6?text=Pipe+Caliper+Icon" alt="Pipe Caliper" class="w-20 h-auto object-contain rounded flex-shrink-0"><div><h4 class="font-semibold text-indigo-800">Pipe Caliper / Vernier Caliper (पाइप कैलिपर / वर्नियर कैलिपर)</h4><p class="text-sm">Used to measure the internal and external diameter of pipes and fittings with high precision. Essential for selecting correct sizes. (पाइप के आंतरिक और बाहरी व्यास को मापने के लिए।)</p></div></div></div>`
            },
            'practice_drills_en': {
                title: "Practice Drills (अभ्यास अभ्यास)",
                image: "https://placehold.co/300x150/E0F2FE/3B82F6?text=Practice+Exercises",
                body: `<p class="mb-3 text-gray-600">Test your knowledge with these quick questions: (इन त्वरित प्रश्नों के साथ अपने ज्ञान का परीक्षण करें:)</p><div class="p-3 bg-green-50 rounded-lg shadow"><h4 class="font-semibold text-green-800 mb-1">Q1: A pipe has an outer diameter of 50mm and a wall thickness of 5mm. What is its inner diameter?</h4><p class="italic text-green-600 mb-1">(एक पाइप का बाहरी व्यास 50 मिमी और दीवार की मोटाई 5 मिमी है। इसका आंतरिक व्यास क्या है?)</p><p class="text-sm">A: 40mm (Inner Diameter = Outer Diameter - 2 * Wall Thickness) (उत्तर: 40मिमी)</p></div> <div class="p-3 bg-green-50 rounded-lg shadow"><h4 class="font-semibold text-green-800 mb-1">Q2: True or False: It is safe to work on plumbing near live electrical wires without shutting off the power first.</h4><p class="italic text-green-600 mb-1">(सही या गलत: बिजली बंद किए बिना जीवित बिजली के तारों के पास प्लंबिंग पर काम करना सुरक्षित है।)</p><p class="text-sm">A: False. Always ensure electrical power is off and locked out/tagged out before working near electrical hazards. (उत्तर: गलत। हमेशा सुनिश्चित करें कि बिजली बंद है।)</p></div>`
            }
        };
        // Placeholder for premium content - structure similar to freeContentData
        const premiumContentData = {
            'handwritten_notes_hi': { title: "Premium: हस्तलिखित नोट्स (Handwritten Notes)", image: "https://placehold.co/300x150/FFFBEB/F59E0B?text=Premium+Notes", body: "<p>यह प्रीमियम हस्तलिखित नोट्स का अनुभाग है। विस्तृत जानकारी जल्द ही उपलब्ध होगी। (This is the premium handwritten notes section. Detailed information will be available soon.)</p>" },
            'theory_hi': { title: "Premium: थ्योरी (Theory)", image: "https://placehold.co/300x150/FFFBEB/F59E0B?text=Premium+Theory", body: "<p>यह प्रीमियम थ्योरी अनुभाग है। विस्तृत जानकारी जल्द ही उपलब्ध होगी। (This is the premium theory section. Detailed information will be available soon.)</p>" },
            'mock_test_hi': { title: "Premium: मॉक टेस्ट (Mock Test)", image: "https://placehold.co/300x150/FFFBEB/F59E0B?text=Premium+Mock+Test", body: "<p>यह प्रीमियम मॉक टेस्ट अनुभाग है। विस्तृत जानकारी जल्द ही उपलब्ध होगी। (This is the premium mock test section. Detailed information will be available soon.)</p>" },
            'test_preparation_hi': { title: "Premium: टेस्ट तैयारी (Test Preparation)", image: "https://placehold.co/300x150/FFFBEB/F59E0B?text=Premium+Test+Prep", body: "<p>यह प्रीमियम टेस्ट तैयारी अनुभाग है। विस्तृत जानकारी जल्द ही उपलब्ध होगी। (This is the premium test preparation section. Detailed information will be available soon.)</p>" },
            'file_making_hi': { title: "Premium: फाइल मेकिंग (File Making)", image: "https://placehold.co/300x150/FFFBEB/F59E0B?text=Premium+File+Making", body: "<p>यह प्रीमियम फाइल मेकिंग अनुभाग है। विस्तृत जानकारी जल्द ही उपलब्ध होगी। (This is the premium file making section. Detailed information will be available soon.)</p>" },
            'tools_detail_hi': { title: "Premium: उपकरण विवरण (Tools Detail)", image: "https://placehold.co/300x150/FFFBEB/F59E0B?text=Premium+Tools", body: "<p>यह प्रीमियम उपकरण विवरण अनुभाग है। विस्तृत जानकारी जल्द ही उपलब्ध होगी। (This is the premium tools detail section. Detailed information will be available soon.)</p>" }
        };

        function openContentModalGeneric(contentKey, isPremium = false) {
            const data = isPremium ? premiumContentData[contentKey] : freeContentData[contentKey];
            if (data) {
                contentModalTitle.textContent = data.title;
                if (data.image) {
                    contentModalImage.src = data.image;
                    contentModalImageContainer.classList.remove('hidden');
                } else {
                    contentModalImageContainer.classList.add('hidden');
                }
                contentModalBody.innerHTML = data.body;
            } else {
                contentModalTitle.textContent = "Content Not Available (सामग्री उपलब्ध नहीं है)";
                contentModalImageContainer.classList.add('hidden');
                contentModalBody.innerHTML = "<p>The content for this section is currently unavailable. Please check back later. (इस अनुभाग के लिए सामग्री वर्तमान में उपलब्ध नहीं है। कृपया बाद में वापस देखें।)</p>";
            }
            contentModal.classList.remove('hidden');
            contentModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }


        document.querySelectorAll('#freePlumberEnglishSubCardsContainer .free-sub-card').forEach(card => {
            card.addEventListener('click', () => {
                const contentKey = card.dataset.subtest; 
                openContentModalGeneric(contentKey, false);
            });
        });

        closeContentModalButton.addEventListener('click', () => {
            contentModal.classList.add('hidden');
            contentModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        });
        
        contentModal.addEventListener('click', (event) => { 
            if (event.target === contentModal) {
                contentModal.classList.add('hidden');
                contentModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        });

    </script>

</body>
</html>
